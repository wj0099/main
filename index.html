<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>장애물 달리기 게임</title>

  <!-- === CSS === -->
  <style>
    /* 레이아웃 -------------------------------------------------- */
    body{
      margin:0; padding:0;
      background:#eef;
      display:flex; justify-content:center; align-items:center;
      height:100vh; overflow:hidden;
      font-family:Verdana, Geneva, Tahoma, sans-serif;
    }
    #game{
      position:relative;
      width:800px; height:250px;
      background:#fff;
      border:4px solid #333;
      overflow:hidden;
      box-shadow:0 8px 25px rgba(0,0,0,.15);
    }

    /* 주인공 ---------------------------------------------------- */
    #player{
      position:absolute; left:50px; bottom:0;
      width:40px; height:60px;
      background:#ff4d4d;
      border-radius:6px;
    }

    /* 장애물 ---------------------------------------------------- */
    #obstacle{
      position:absolute; right:-50px; bottom:0;
      width:40px; height:60px;
      background:#333;
      animation: obstacleMove 2.5s linear infinite;
    }
    @keyframes obstacleMove{
      0%   { right:-50px; }
      100% { right:850px; }  /* 게임판 너비 + 여분 */
    }

    /* 점프 애니메이션 ------------------------------------------ */
    .jump{ animation: jump .5s ease-out; }
    @keyframes jump{
      0%   { bottom:0; }
      50%  { bottom:120px; }  /* 점프 높이 */
      100% { bottom:0; }
    }

    /* UI 요소 --------------------------------------------------- */
    #score{
      position:absolute; top:10px; left:15px;
      font-size:20px; font-weight:bold;
      color:#000;
    }
    #message{
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      text-align:center; display:none;
      color:#222;
    }
    #message span{ font-size:32px; font-weight:bold; }
    #message button{
      margin-top:15px; padding:10px 22px;
      font-size:18px; border:none; border-radius:4px;
      cursor:pointer; background:#0066ff; color:#fff;
    }
    /* 다크모드 스위치 */
    .darkmode{ position:fixed; top:12px; right:14px; font-size:14px; user-select:none; }
  </style>
</head>
<body>

<!-- === HTML === -->
<div id="game">
  <div id="player"></div>
  <div id="obstacle"></div>

  <div id="score">Score: 0</div>

  <div id="message">
    <span id="msgText">Game Over</span><br>
    <button id="restart">Restart</button>
  </div>
</div>

<label class="darkmode">
  <input type="checkbox" id="toggleDark"> Dark Mode
</label>

<!-- === JavaScript === -->
<script>
  const player = document.getElementById('player');
  const obstacle = document.getElementById('obstacle');
  const scoreEl = document.getElementById('score');
  const msgBox = document.getElementById('message');
  const msgText = document.getElementById('msgText');
  const restartBtn = document.getElementById('restart');
  const toggleDark = document.getElementById('toggleDark');

  let score = 0;
  let alive = true;
  let obstacleSpeed = 2500;   // ms (속도)

  /* 1) 점프 --------------------------------------------------- */
  function jump(){
    if(player.classList.contains('jump')) return; // 연타 방지
    player.classList.add('jump');
    setTimeout(()=>player.classList.remove('jump'), 500);
  }
  document.addEventListener('keydown', e=>{
    if(!alive) return;
    if(e.code === 'Space' || e.code === 'ArrowUp'){
      jump();
    }
  });

  /* 2) 충돌 체크 --------------------------------------------- */
  function isHit(){
    const p = player.getBoundingClientRect();
    const o = obstacle.getBoundingClientRect();
    return ( p.right  > o.left &&
             p.left   < o.right &&
             p.bottom > o.top  &&
             p.top    < o.bottom );
  }

  /* 3) 루프(점수·충돌) ---------------------------------------- */
  function update(){
    if(!alive) return;

    if(isHit()){
      gameOver();
      return;
    }
    score++;
    scoreEl.textContent = 'Score: ' + score;

    // 일정 점수마다 속도 상승
    if(score % 500 === 0){ speedUp(); }

    requestAnimationFrame(update);
  }

  /* 4) 난이도 상승 ------------------------------------------- */
  function speedUp(){
    obstacleSpeed *= 0.9; // 10% 빨라짐
    obstacle.style.animation = 'none';   // 리셋
    void obstacle.offsetWidth;           // 강제 재계산
    obstacle.style.animation = `obstacleMove ${obstacleSpeed}ms linear infinite`;
  }

  /* 5) 게임오버/재시작 ---------------------------------------- */
  function gameOver(){
    alive = false;
    msgText.textContent = `Game Over 😵\nScore: ${score}`;
    msgBox.style.display = 'block';
    obstacle.style.animationPlayState = 'paused';
  }
  restartBtn.addEventListener('click', ()=>{
    score = 0;
    scoreEl.textContent = 'Score: 0';
    msgBox.style.display = 'none';
    alive = true;
    obstacle.style.animation = 'none';
    void obstacle.offsetWidth;
    obstacle.style.animation = `obstacleMove ${obstacleSpeed}ms linear infinite`;
    requestAnimationFrame(update);
  });

  /* 6) 다크모드 토글 ------------------------------------------ */
  toggleDark.addEventListener('change', e=>{
    if(e.target.checked){
      document.body.style.background = '#111';
      game.style.background          = '#222';
      game.style.borderColor         = '#ddd';
      scoreEl.style.color            = '#fff';
    }else{
      document.body.style.background = '#eef';
      game.style.background          = '#fff';
      game.style.borderColor         = '#333';
      scoreEl.style.color            = '#000';
    }
  });

  /* 7) 게임 시작 ---------------------------------------------- */
  requestAnimationFrame(update);
</script>
</body>
</html>
