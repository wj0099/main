<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¯¸ë¡œ íƒˆì¶œ ê²Œì„</title>

    <!-- === CSS === -->
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f8ff;
            font-family: Arial, sans-serif;
            user-select: none;
        }

        #maze-container {
            border: 5px solid #333;
            background-color: #fff;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        /* CSS Gridë¥¼ ì´ìš©í•´ ë¯¸ë¡œ êµ¬ì¡° ìƒì„± */
        #maze {
            display: grid;
            /* JSì—ì„œ grid-template-columnsë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. */
        }

        /* ë¯¸ë¡œ ì…€ ìŠ¤íƒ€ì¼ */
        .cell {
            width: 30px;
            height: 30px;
            box-sizing: border-box;
            background-color: #f0f0f0;
            transition: background-color 0.1s ease;
        }

        /* ë²½ */
        .wall-top { border-top: 3px solid #333; }
        .wall-right { border-right: 3px solid #333; }
        .wall-bottom { border-bottom: 3px solid #333; }
        .wall-left { border-left: 3px solid #333; }
        
        /* í”Œë ˆì´ì–´ */
        .player {
            background-color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
            position: relative;
            z-index: 10;
        }
        
        /* ì‹œì‘ ë° ë„ì°© ì§€ì  */
        .start { background-color: #28a745; /* ì´ˆë¡ìƒ‰ ì‹œì‘ */ }
        .end { background-color: #007bff; /* íŒŒë€ìƒ‰ ë„ì°© */ }

        /* ë©”ì‹œì§€ ë° ì»¨íŠ¸ë¡¤ */
        #message {
            margin-top: 20px;
            padding: 10px 20px;
            background: #fff;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #message button {
            margin-left: 10px;
            padding: 8px 15px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<!-- === HTML === -->
<div id="maze-container">
    <div id="maze">
        <!-- ë¯¸ë¡œëŠ” JSë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
    </div>
</div>

<div id="message">
    <span id="game-status">â† â†‘ â†“ â†’ í‚¤ë¥¼ ëˆŒëŸ¬ ì´ë™í•˜ì„¸ìš”.</span>
    <button onclick="window.location.reload()">ìƒˆ ë¯¸ë¡œ ìƒì„±</button>
</div>

<!-- === JavaScript === -->
<script>
    const MAZE_SIZE = 15; // ë¯¸ë¡œ í¬ê¸° (15x15)
    const mazeElement = document.getElementById('maze');
    const statusElement = document.getElementById('game-status');

    let maze = []; // ë¯¸ë¡œ êµ¬ì¡°ë¥¼ ì €ì¥í•˜ëŠ” 2D ë°°ì—´
    let player = { x: 0, y: 0 }; // í”Œë ˆì´ì–´ ìœ„ì¹˜
    let isGameRunning = true;
    let cells = []; // DOM ìš”ì†Œë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´

    // ë¯¸ë¡œì˜ Cell ìƒíƒœ ì •ì˜ (ë²½ ì •ë³´)
    const Cell = {
        WALL: 0,
        PATH: 1
    };

    // 1. ë¯¸ë¡œ ì´ˆê¸°í™” ë° CSS Grid ì„¤ì •
    function initializeMaze() {
        mazeElement.style.gridTemplateColumns = `repeat(${MAZE_SIZE}, 1fr)`;

        // 2D ë°°ì—´ ì´ˆê¸°í™”: ëª¨ë“  ì¹¸ì„ ë²½ìœ¼ë¡œ ì„¤ì •
        for (let y = 0; y < MAZE_SIZE; y++) {
            maze[y] = [];
            cells[y] = [];
            for (let x = 0; x < MAZE_SIZE; x++) {
                maze[y][x] = {
                    visited: false,
                    walls: { top: true, right: true, bottom: true, left: true },
                    isStart: (x === 0 && y === 0),
                    isEnd: (x === MAZE_SIZE - 1 && y === MAZE_SIZE - 1)
                };

                // DOM ìš”ì†Œ ìƒì„±
                const cellDiv = document.createElement('div');
                cellDiv.classList.add('cell');
                mazeElement.appendChild(cellDiv);
                cells[y][x] = cellDiv;
            }
        }
    }

    // 2. ë¯¸ë¡œ ìƒì„± ì•Œê³ ë¦¬ì¦˜ (ê¹Šì´ ìš°ì„  íƒìƒ‰ ê¸°ë°˜ ë°±íŠ¸ë˜í‚¹)
    function generateMaze(x, y) {
        maze[y][x].visited = true;

        const neighbors = [
            { dx: 0, dy: -1, wall: 'top', opposite: 'bottom' }, // Up
            { dx: 1, dy: 0, wall: 'right', opposite: 'left' },  // Right
            { dx: 0, dy: 1, wall: 'bottom', opposite: 'top' },  // Down
            { dx: -1, dy: 0, wall: 'left', opposite: 'right' }  // Left
        ].sort(() => Math.random() - 0.5); // ì´ì›ƒë“¤ì„ ë¬´ì‘ìœ„ë¡œ ì„ìŒ

        for (const neighbor of neighbors) {
            const nx = x + neighbor.dx;
            const ny = y + neighbor.dy;

            // ë¯¸ë¡œ ê²½ê³„ ì²´í¬
            if (nx >= 0 && nx < MAZE_SIZE && ny >= 0 && ny < MAZE_SIZE) {
                if (!maze[ny][nx].visited) {
                    // í˜„ì¬ ì…€ê³¼ ì´ì›ƒ ì…€ì˜ ë²½ì„ í—ˆë­„
                    maze[y][x].walls[neighbor.wall] = false;
                    maze[ny][nx].walls[neighbor.opposite] = false;

                    generateMaze(nx, ny); // ì¬ê·€ í˜¸ì¶œ
                }
            }
        }
    }

    // 3. ë¯¸ë¡œ DOM ë Œë”ë§
    function drawMaze() {
        for (let y = 0; y < MAZE_SIZE; y++) {
            for (let x = 0; x < MAZE_SIZE; x++) {
                const cell = maze[y][x];
                const cellDiv = cells[y][x];
                
                // ë²½ í´ë˜ìŠ¤ ì—…ë°ì´íŠ¸
                cellDiv.className = 'cell'; // ì´ˆê¸°í™”
                if (cell.walls.top) cellDiv.classList.add('wall-top');
                if (cell.walls.right) cellDiv.classList.add('wall-right');
                if (cell.walls.bottom) cellDiv.classList.add('wall-bottom');
                if (cell.walls.left) cellDiv.classList.add('wall-left');

                // ì‹œì‘/ë„ì°© ì§€ì  í‘œì‹œ
                if (cell.isStart) cellDiv.classList.add('start');
                if (cell.isEnd) cellDiv.classList.add('end');
            }
        }
        updatePlayerPosition();
    }

    // 4. í”Œë ˆì´ì–´ ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ë° ë Œë”ë§
    function updatePlayerPosition() {
        // ê¸°ì¡´ ìœ„ì¹˜ í´ë˜ìŠ¤ ì œê±°
        cells.forEach(row => row.forEach(cell => cell.classList.remove('player')));
        
        // ìƒˆ ìœ„ì¹˜ì— í´ë˜ìŠ¤ ì¶”ê°€
        cells[player.y][player.x].classList.add('player');
        
        // ì‹œì‘/ë„ì°© ì§€ì  í´ë˜ìŠ¤ ë³µì› (í”Œë ˆì´ì–´ í´ë˜ìŠ¤ê°€ ë®ì–´ì“°ë¯€ë¡œ)
        if (maze[0][0].isStart) cells[0][0].classList.add('start');
        if (maze[MAZE_SIZE - 1][MAZE_SIZE - 1].isEnd) cells[MAZE_SIZE - 1][MAZE_SIZE - 1].classList.add('end');
    }


    // 5. í‚¤ë³´ë“œ ì´ë™ ì²˜ë¦¬
    function movePlayer(dx, dy, wallCheck) {
        if (!isGameRunning) return;

        const nextX = player.x + dx;
        const nextY = player.y + dy;
        
        const currentCell = maze[player.y][player.x];

        // í•´ë‹¹ ë°©í–¥ìœ¼ë¡œ ë²½ì´ ì—†ëŠ”ì§€ í™•ì¸
        if (!currentCell.walls[wallCheck]) {
            // ë¯¸ë¡œ ê²½ê³„ë¥¼ ë²—ì–´ë‚˜ì§€ ì•ŠëŠ”ì§€ ìµœì¢… í™•ì¸
            if (nextX >= 0 && nextX < MAZE_SIZE && nextY >= 0 && nextY < MAZE_SIZE) {
                player.x = nextX;
                player.y = nextY;
                updatePlayerPosition();

                // ë„ì°© ì²´í¬
                if (maze[player.y][player.x].isEnd) {
                    gameWin();
                }
            }
        } else {
             // ë²½ì— ë¶€ë”ªí˜”ì„ ë•Œ ì‹œê°ì  í”¼ë“œë°±
             cells[player.y][player.x].style.backgroundColor = '#ff6666';
             setTimeout(() => {
                cells[player.y][player.x].style.backgroundColor = '#f0f0f0';
                if (maze[player.y][player.x].isStart) cells[player.y][player.x].style.backgroundColor = '#28a745';
                if (maze[player.y][player.x].isEnd) cells[player.y][player.x].style.backgroundColor = '#007bff';
             }, 100);
        }
    }

    document.addEventListener('keydown', (e) => {
        if (!isGameRunning) return;
        
        switch (e.key) {
            case 'ArrowUp':
                movePlayer(0, -1, 'top');
                break;
            case 'ArrowDown':
                movePlayer(0, 1, 'bottom');
                break;
            case 'ArrowLeft':
                movePlayer(-1, 0, 'left');
                break;
            case 'ArrowRight':
                movePlayer(1, 0, 'right');
                break;
        }
    });

    // 6. ê²Œì„ ìŠ¹ë¦¬
    function gameWin() {
        isGameRunning = false;
        statusElement.textContent = `ğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ë¯¸ë¡œë¥¼ íƒˆì¶œí–ˆìŠµë‹ˆë‹¤!`;
        cells[player.y][player.x].style.backgroundColor = '#00ff00';
    }

    // 7. ê²Œì„ ì‹œì‘
    function startGame() {
        initializeMaze();
        generateMaze(player.x, player.y); // (0, 0)ì—ì„œ ë¯¸ë¡œ ìƒì„± ì‹œì‘
        drawMaze();
        statusElement.textContent = 'â† â†‘ â†“ â†’ í‚¤ë¥¼ ëˆŒëŸ¬ ì´ë™í•˜ì„¸ìš”.';
    }

    startGame();

</script>
</body>
</html>
